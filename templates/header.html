<header class="main-header">
    <div class="header-left">
        <img src="https://gnezenca.github.io/krajovastrona/images/gnezensky_herb.jpg" alt="Gnezensky herb" class="flag-icon">
    </div>
    <nav class="header-nav">
        <button class="nav-button" data-key="main-page"><a href="https://gnezenca.github.io/krajovastrona">HLOVNA STRONA</a></button>
        <div class="dropdown">
            <button class="nav-button dropdown-toggle" data-key="about-us"><a>O NAS</a></button>
            <div class="dropdown-content">
                <ul>
                    <li><button class="nav-button" data-key="history"><a href="https://gnezenca.github.io/krajovastrona/istora.html">ISTORA</a></button></li>
                </ul>
            </div>
        </div>
        <button class="nav-button" data-key="country"><a href="https://gnezenca.github.io/krajovastrona/kraj.html">KRAJ</a></button>
        <button class="nav-button" data-key="nation"><a href="https://gnezenca.github.io/krajovastrona/narod.html">NAROD</a></button>
        
        <div class="dropdown">
            <button class="nav-button dropdown-toggle" data-key="language"><a>MOVA</a></button>
            <div class="dropdown-content">
                <ul>
                    <li><button class="nav-button" data-key="grammar"><a href="https://gnezenca.github.io/krajovastrona/gramatyka.html">GRAMATYKA</a></button></li>
                    <li><button class="nav-button" data-key="dictionary"><a href="https://gnezenca.github.io/krajovastrona/slovozbor">SLOVOZBOR</a></button></li>
                </ul>
            </div>
        </div>
        <div id="clock">--.--.---- --:--:--</div>
    </nav>
    <div class="language-switcher">
        <button class="lang-button" data-lang="gnz">
            <img src="https://gnezenca.github.io/krajovastrona/images/gnezenska_flaga.png" alt="Gnezensky flag" class="lang-icon">
        </button>
        <button class="lang-button" data-lang="pol">
            <img src="https://gnezenca.github.io/krajovastrona/images/gneznicka_flaga.png" alt="Poland flag" class="lang-icon">
        </button>
        <button class="lang-button" data-lang="eng">
            <img src="https://gnezenca.github.io/krajovastrona/images/anglova_flaga.png" alt="UK flag" class="lang-icon">
        </button>
    </div>
</header>

  <script>
    const BASE_TZ = 'Europe/Warsaw';  // Strefa bazowa: Polska
    const DISPLAY_OFFSET_MS = 60 * 60 * 1000; // Dodajemy +1 godzinę
    const RESYNC_INTERVAL_MS = 60 * 1000; // Synchronizacja co 1 minutę

    // Formatter do wyświetlania daty i godziny
    const timeFmt = new Intl.DateTimeFormat('pl-PL', {
      day: '2-digit',
      month: '2-digit',
      year: 'numeric',
      hour: '2-digit',
      minute: '2-digit',
      second: '2-digit',
      hour12: false,
      timeZone: BASE_TZ
    });

    const clockEl = document.getElementById('clock');
    let baseServerEpochMs = null;
    let basePerfMs = null;
    let resyncTimer = null;

    // Pobiera czas z worldtimeapi.org
    async function fetchWarsawTime() {
      const r = await fetch('https://worldtimeapi.org/api/timezone/' + BASE_TZ, { cache: 'no-store' });
      if (!r.ok) throw new Error('HTTP ' + r.status);
      const data = await r.json();
      return new Date(data.datetime).getTime();
    }

    async function syncNow() {
      try {
        const warsawEpoch = await fetchWarsawTime();
        baseServerEpochMs = warsawEpoch + DISPLAY_OFFSET_MS; // Dodajemy +1h
        basePerfMs = performance.now();
      } catch (e) {
        clockEl.textContent = 'Błąd pobierania czasu';
      }
    }

    function tick() {
      if (baseServerEpochMs != null && basePerfMs != null) {
        const elapsed = performance.now() - basePerfMs;
        const currentEpoch = baseServerEpochMs + elapsed;
        const displayStr = timeFmt.format(new Date(currentEpoch));
        clockEl.textContent = displayStr;
      }
      requestAnimationFrame(tick);
    }

    function setupResync() {
      if (resyncTimer) clearInterval(resyncTimer);
      resyncTimer = setInterval(syncNow, RESYNC_INTERVAL_MS);
    }

    // Start
    (async () => {
      await syncNow();
      setupResync();
      tick();
    })();
  </script>
